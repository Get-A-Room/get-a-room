openapi: 3.0.0
servers:
    # Added by API Auto Mocking Plugin
    - description: SwaggerHub API Auto Mocking
      url: https://virtserver.swaggerhub.com/Mikkooo/api/1.0.0
    - description: The staging environment
      url: oispahuone.com
info:
    description: This is the API for get a room backend
    version: 0.2.0
    title: Get a room! API
    contact:
        email: mikko.m.pirhonen@tuni.fi
    license:
        name: MIT License
        url: https://opensource.org/licenses/MIT
tags:
    - name: preferences
    - name: bookings

paths:
    /preferences:
        get:
            tags:
                - preferences
            summary: Get preferences for the user
            operationId: getPreferences
            description: |
                The current user is resolved from the request and the corresponding preferences are returned
            responses:
                '200':
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/preferences'
                '401':
                    description: User was not authenticated
        put:
            tags:
                - preferences
            summary: Replace preferences for the user
            operationId: updatePreferences
            description: |
                The current user is resolved from the request and the corresponding preferences are updated
            requestBody:
                description: The new preferences
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/preferences'
            responses:
                '200':
                    description: The updated preferences
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/preferences'
                '400':
                    description: The preference object was malformed
                '401':
                    description: The user was not authenticated

    /booking:
        post:
            tags:
                - bookings
            summary: Make a booking
            operationId: makeBooking
            description: |
                The selected resource is booked with the details specified in the request body and  the current user
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/bookingDetails'
            responses:
                '200':
                    description: The new booking
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/booking'
                '400':
                    description: The bookingDetails object was malformed
                '401':
                    description: The user was not authenticated
                '409':
                    description: The room was no longer available for the booking
    /booking/current:
        get:
            tags:
                - bookings
            summary: Get the status of the current booking of the user
            operationId: getCurrentBooking
            description: |
                Current booking is a booking that is currently ongoing.
            responses:
                '200':
                    description: The current booking
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/booking'
                '401':
                    description: The user was not authenticated

    /booking/{bookingId}:
        parameters:
            - name: 'bookingId'
              in: 'path'
              description: 'ID of the booking'
              required: true
              schema:
                  $ref: '#/components/schemas/uuid'
        # Might not be needed
        get:
            tags:
                - bookings
            summary: Get details for a booking
            operationId: getBooking
            description: |
                Get details of a booking by it's id
            responses:
                '200':
                    description: The booking
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/booking'
                '401':
                    description: The user was not authenticated
                '404':
                    description: Booking not found
        delete:
            tags:
                - bookings
            summary: Delete a booking
            operationId: deleteBooking
            description: |
                Delete a booking by it's id
            responses:
                '204':
                    description: Booking was deleted successfully
                '401':
                    description: The user was not authenticated
                '403':
                    description: The user was not authorized delete this booking
                '404':
                    description: Booking not found

    /booking/{bookingId}/addTime:
        parameters:
            - name: 'bookingId'
              in: 'path'
              description: 'ID of the booking to update'
              required: true
              # will change, depends on google format?
              schema:
                  $ref: '#/components/schemas/uuid'
        # unsure of the details of this one, will most likely change
        patch:
            tags:
                - bookings
            summary: Add time to a booking
            operationId: addTimeToBooking
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/addTimeDetails'
            description: |
                Adds the specified time to a booking
            responses:
                '200':
                    description: The modified booking
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/booking'
                '401':
                    description: The user was not authenticated
                '403':
                    description: The user was not authorized to add time for this booking

    /availableRooms:
        get:
            tags:
                - bookings
            parameters:
                - name: 'building'
                  in: query
                  description: Building to filter by
                  required: false
                  schema:
                      $ref: '#/components/schemas/uuid'
            summary: Get available rooms
            operationId: getAvailableRooms
            description: |
                Available rooms don't currently have a booking
            responses:
                '200':
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/availableRoom'
                '401':
                    description: The user was not authenticated
    /buildings:
        get:
            tags:
                - bookings
                - preferences
            summary: Get available buildings
            operationId: getBuildings
            description: |
                Conference rooms are located in buildings.
                Buildings can be used to group rooms
            responses:
                '200':
                    description: OK
                '401':
                    description: The user was not authenticated

components:
    schemas:
        uuid:
            type: string
            format: uuid
            example: d290f1ee-6c54-4b01-90e6-d701748f0851
        room:
            type: object
            required:
                - id
                - name
                - minutesAvailable
            properties:
                id:
                    $ref: '#/components/schemas/uuid'
                name:
                    type: string
                    nullable: false
                    example: Small meeting room 1
                labels:
                    type: array
                    example: [Shark tank, TV]
                    items:
                        type: string
        availableRoom:
            type: object
            required:
                - room
                - availableFor
            properties:
                room:
                    $ref: '#/components/schemas/room'
                availableFor:
                    type: number
                    description: Minutes this room is available for
                    example: 120
        building:
            type: object
            required:
                - id
                - name
            properties:
                id:
                    $ref: '#/components/schemas/uuid'
                name:
                    type: string
                    example: Hermia 5
        preferences:
            type: object
            required:
                - favouriteBuilding
            properties:
                favouriteBuilding:
                    $ref: '#/components/schemas/building'
        bookingDetails:
            type: object
            required:
                - duration
                - title
                - roomId
            properties:
                duration:
                    type: number
                    description: Duration of booking in minutes
                    example: 60
                title:
                    type: string
                    example: Weekly software meeting
                roomId:
                    $ref: '#/components/schemas/uuid'
        booking:
            type: object
            required:
                - id
                - startTime
                - endTime
                - room
            properties:
                id:
                    $ref: '#/components/schemas/uuid'
                startTime:
                    type: string
                    format: date-time
                endTime:
                    type: string
                    format: date-time
                room:
                    $ref: '#/components/schemas/room'
        addTimeDetails:
            type: object
            required:
                - timeToAdd
            properties:
                timeToAdd:
                    type: number
                    description: Time to add to booking
                    example: 15
